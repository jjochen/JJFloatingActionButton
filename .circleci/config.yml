version: 2

jobs:
  build-and-test:

    macos:
      xcode: "9.0"

    steps:
      - checkout

      - run:
          name: Fetch CocoaPods Specs
          command: curl https://cocoapods-specs.circleci.com/fetch-cocoapods-repo-from-s3.sh | bash -s cf

      - run:
          name: Install CocoaPods
          command: pod install --repo-update --project-directory=Example

      - run:
          name: Build and run tests
          command: ./Scripts/test_iOS11.0.1_iPhoneX.sh

      - run: 
          name: Codecov
          command: bash <(curl -s https://codecov.io/bash)

      - run:
          name: Lint Podspec
          command: pod lib lint



workflows:
  version: 2
  build-and-test:
    jobs:
      - build-and-test